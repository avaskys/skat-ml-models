name: Release

# This workflow validates releases but does NOT upload model files.
# Model files (.onnx) are large and must be exported locally, then uploaded manually.
#
# Release process:
# 1. Export models locally: python scripts/export_onnx.py --all
# 2. Update models.json with new hashes
# 3. Commit and push
# 4. Create release with: gh release create vX.Y.Z models/*.onnx models/*.onnx.data models.json interface/*.json

on:
  push:
    tags:
      - 'v*'

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Validate release files exist
        run: |
          echo "Checking required files for release..."

          # Check interface specs are present
          if [[ ! -f "interface/feature_spec.json" ]]; then
            echo "::error::Missing interface/feature_spec.json"
            exit 1
          fi

          if [[ ! -f "interface/test_vectors.json" ]]; then
            echo "::error::Missing interface/test_vectors.json"
            exit 1
          fi

          if [[ ! -f "models.json" ]]; then
            echo "::error::Missing models.json"
            exit 1
          fi

          echo "âœ“ All required files present"
          echo ""
          echo "Note: ONNX model files must be uploaded manually via:"
          echo "  gh release upload ${GITHUB_REF#refs/tags/} models/*.onnx models/*.onnx.data"
